# Postman Demo Guide: Webhook Signature Validation

## Overview

This guide shows how to demonstrate valid and invalid webhook signatures using Postman. Perfect for demos and presentations!

---

## Quick Setup (5 minutes)

### Step 1: Import Collection

1. Open Postman
2. Click **Import** button
3. Select `postman-webhook-signature-tests.json`
4. Collection imported with 3 pre-configured requests

### Step 2: Set Variables

Click on the collection → **Variables** tab:

| Variable         | Value                | Example                                                           |
| ---------------- | -------------------- | ----------------------------------------------------------------- |
| `webhook_url`    | Your API Gateway URL | `https://abc123.execute-api.us-east-1.amazonaws.com/Prod/webhook` |
| `webhook_secret` | Your secret from AWS | `my_super_secret_key_12345`                                       |

**Get your values:**

```powershell
# Get webhook URL
aws cloudformation describe-stacks --stack-name jira-github-integration --query 'Stacks[0].Outputs[?OutputKey==`WebhookUrl`].OutputValue' --output text

# Get secret
(aws secretsmanager get-secret-value --secret-id jira-github-webhook-secret --query SecretString --output text | ConvertFrom-Json).webhook_secret
```

---

## Manual Setup (Without Collection)

### Request 1: ✅ Valid Signature

#### Configuration

- **Method:** `POST`
- **URL:** `{{webhook_url}}`
- **Headers:**
  - `Content-Type`: `application/json`
  - `X-Hub-Signature`: (generated by pre-request script)

#### Body (raw JSON)

```json
{
  "issue": {
    "key": "DEMO-001",
    "fields": {
      "summary": "Valid Signature Test",
      "description": "Testing with correct HMAC signature",
      "labels": ["sync-to-github", "demo"],
      "priority": {
        "name": "High"
      }
    }
  }
}
```

#### Pre-request Script

```javascript
// Generate valid HMAC SHA-256 signature
const secret = pm.collectionVariables.get("webhook_secret");
const payload = pm.request.body.raw;

// Create HMAC signature
const hash = CryptoJS.HmacSHA256(payload, secret);
const signature = "sha256=" + hash.toString(CryptoJS.enc.Hex);

// Set header
pm.request.headers.add({
  key: "X-Hub-Signature",
  value: signature,
});

console.log("Generated signature:", signature.substring(0, 30) + "...");
```

#### Expected Result

- **Status:** `200 OK`
- **Response:** Success message
- ✅ Request accepted with valid signature

---

### Request 2: ❌ Invalid Signature

#### Configuration

- **Method:** `POST`
- **URL:** `{{webhook_url}}`
- **Headers:**
  - `Content-Type`: `application/json`
  - `X-Hub-Signature`: `sha256=INVALID_SIGNATURE_MALICIOUS_ATTEMPT_123456789`

#### Body (raw JSON)

```json
{
  "issue": {
    "key": "DEMO-002",
    "fields": {
      "summary": "Invalid Signature Test",
      "description": "Testing with wrong signature",
      "labels": ["sync-to-github", "demo"]
    }
  }
}
```

#### Expected Result

- **Status:** `401 Unauthorized` or `403 Forbidden`
- **Response:** Error message about invalid signature
- ❌ Request rejected

---

### Request 3: ❌ Missing Signature

#### Configuration

- **Method:** `POST`
- **URL:** `{{webhook_url}}`
- **Headers:**
  - `Content-Type`: `application/json`
  - ⚠️ **NO X-Hub-Signature header**

#### Body (raw JSON)

```json
{
  "issue": {
    "key": "DEMO-003",
    "fields": {
      "summary": "No Signature Test",
      "description": "Testing without signature header",
      "labels": ["sync-to-github", "demo"]
    }
  }
}
```

#### Expected Result

- **Status:** `401 Unauthorized` or `403 Forbidden`
- **Response:** Error message about missing signature
- ❌ Request rejected

---

## Demo Flow

### 1. Setup Phase (Show audience)

```
1. Open Postman
2. Show collection with 3 requests
3. Show collection variables (URL and secret)
4. Explain: "We'll test 3 scenarios"
```

### 2. Test 1: Valid Signature ✅

```
1. Select "Valid Signature" request
2. Show the pre-request script tab
3. Explain: "Script automatically generates correct HMAC"
4. Click Send
5. Show: Status 200 OK
6. Explain: "Legitimate request accepted"
```

### 3. Test 2: Invalid Signature ❌

```
1. Select "Invalid Signature" request
2. Show Headers tab
3. Point out: "Wrong signature - simulating attacker"
4. Click Send
5. Show: Status 401/403
6. Explain: "Tampered request rejected"
```

### 4. Test 3: Missing Signature ❌

```
1. Select "No Signature" request
2. Show Headers tab (no X-Hub-Signature)
3. Explain: "Unauthorized request with no credentials"
4. Click Send
5. Show: Status 401/403
6. Explain: "Unauthenticated request blocked"
```

---

## Postman Console Tips

**View signature generation:**

1. Open Postman Console (View → Show Postman Console)
2. Send "Valid Signature" request
3. See console log: `Generated signature: sha256=a1b2c3d4...`

**Compare signatures:**

Add this to pre-request script:

```javascript
const secret = pm.collectionVariables.get("webhook_secret");
const payload = pm.request.body.raw;

const hash = CryptoJS.HmacSHA256(payload, secret);
const signature = "sha256=" + hash.toString(CryptoJS.enc.Hex);

console.log("Payload:", payload.substring(0, 50) + "...");
console.log("Secret:", secret);
console.log("Generated Signature:", signature);

pm.request.headers.add({
  key: "X-Hub-Signature",
  value: signature,
});
```

---

## Advanced: Testing Different Scenarios

### Test with Modified Payload

1. Send valid request → 200 OK
2. Change payload (e.g., change issue key)
3. Keep same signature
4. Send → 401 (signature no longer valid)
5. **Demonstrates:** Signature validates payload integrity

### Test with Wrong Secret

1. Change `webhook_secret` variable to wrong value
2. Send request
3. Get 401 - signature computed with wrong secret
4. **Demonstrates:** Secret must match on both sides

### Test Timing Attack Protection

Explain that the code uses `hmac.compare_digest()` which:

- Compares all characters in constant time
- Prevents timing attacks
- Security best practice

---

## Troubleshooting

### "Cannot generate signature - secret not found"

**Fix:** Set `webhook_secret` in collection variables

### Always getting 401 even with valid signature

**Check:**

1. Secret matches AWS Secrets Manager value
2. Payload in body matches exactly (no extra spaces)
3. Content-Type is `application/json`
4. URL is correct

### Pre-request script not running

**Fix:**

1. Ensure script is in "Pre-request Script" tab
2. Check Postman Console for errors
3. Make sure CryptoJS is available (built into Postman)

---

## Export Your Collection

**Share with team:**

1. Right-click collection
2. Export → Collection v2.1
3. Share `postman-webhook-signature-tests.json`
4. Others can import and test immediately

---

## Key Demo Talking Points

### Security Benefits

- ✅ **Authentication:** Only authorized parties can send requests
- ✅ **Integrity:** Payload cannot be modified in transit
- ✅ **Non-repudiation:** Proves sender has the secret
- ✅ **Replay protection:** Signatures are payload-specific

### How HMAC Works

```
HMAC = Hash(Secret + Message)

Valid Request:
  Sender computes: HMAC(secret, payload) → signature
  Receiver computes: HMAC(secret, payload) → expected
  Compare: signature == expected ✅

Invalid Request:
  Attacker sends: random signature
  Receiver computes: HMAC(secret, payload) → expected
  Compare: random != expected ❌
```

### Real-World Analogy

"Like a wax seal on a letter:

- Only someone with the seal can create valid mark
- If letter is opened/changed, seal breaks
- Recipient verifies seal before trusting content"

---

## Quick Demo Script (2 minutes)

**"Let me show you how webhook signature validation protects our integration:"**

1. **[Send Valid]** ✅ "First, a legitimate request from Jira with correct signature - see, 200 OK"

2. **[Send Invalid]** ❌ "Now an attacker tries with wrong signature - rejected with 401"

3. **[Send Missing]** ❌ "Finally, unauthorized request with no credentials - also rejected"

**"This ensures only authenticated Jira webhooks can trigger our integration, protecting against unauthorized access and tampering."**

---

## Additional Resources

- [HMAC Wikipedia](https://en.wikipedia.org/wiki/HMAC)
- [Securing Webhooks](https://docs.github.com/en/webhooks/securing-webhooks)
- See `test-signature-local.py` for local testing
- See `demo-signature-validation.ps1` for automated demo

---

## Next Steps

After demo:

- Update secret regularly for security
- Monitor CloudWatch for failed auth attempts
- Add additional validation (IP whitelist, rate limiting)
- Implement webhook delivery retries in Jira
